{% extends "layout.html" %}
{% from 'macros.html' import download, panellist %}

<!-- Galaxy CSS Sources -->
{% block csshead %}
    <link rel='preconnect stylesheet' href='//cdnjs.cloudflare.com/ajax/libs/ol3/3.14.2/ol.min.css'>
{% endblock csshead %}
<!-- Galaxy JS Sources-->
{% block jshead %}
    <script rel='preconnect' src="//cdnjs.cloudflare.com/ajax/libs/dygraph/1.1.1/dygraph-combined.js"></script>
    <script rel='preconnect' src="//cdnjs.cloudflare.com/ajax/libs/ol3/3.14.2/ol.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/heatmap.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
{% endblock jshead %}

<!-- Single Galaxy Page -->
{% block body %}

<div class='singlegalaxy' id ='{{cube.plateifu}}'>

<script type="text/javascript">
Highcharts.theme = {chart: {backgroundColor: null}};
Highcharts.setOptions(Highcharts.theme);
</script>



<!-- Interactive Map and Spectrum View -->
{# Map and Spectrum View #}
{% if cube %}
<div class='well' id='specview'>
    <div class='row'>
        <div class='col-md-12 galinfo'>
                <!-- static galaxy image -->
                {# Initial Static Image Display #}
                <div class='row' id='staticdiv'>
                    <div class='col-md-3'>
                        <img class='img-responsive' id='staticimage' src="{{image}}" alt="{{cube.plateifu}} Galaxy Image">
                    </div>
                </div>
                <!-- dynamic image and spaxel -->
                {# Dynamic Interaction #}
                <div class='row' id='dynamicdiv' style='display:none;'>
                  <div class='col-md-3'>
                    <div id='mapdiv' class='map' style='width:600px; height:600px;'></div>
                  </div>
                  <div class='col-md-9'>
                    <div id='graphdiv' style="width:100%;"></div>
                    <div class='row'>
                        <div class='col-md-5 col-md-offset-1'>
                          {% if error %}
                          <p class='alert alert-danger' id='specmsg_error'><strong>{{error}}</strong></p>
                          {% else %}
                          <p class='alert alert-danger' id='specmsg' style="display:none;"><strong>{{specmsg}}</strong></p>
                          {% endif %}
                        </div>
                    </div>
                  </div>
                </div>
        </div>
    </div>
</div>
{% endif %}

</div> {# end of singlegalaxydiv #}

{% endblock body %}

<!-- JS Code -->
{% block code %}
<script type='text/javascript'>
    var galaxy = {};
    $(function() {
        m.galaxy = new Galaxy();
        m.galaxy.print();
        // toggle interaction on click
        var spaxel = {{spectra|tojson}};
        var galimage = {{image|tojson}};
        var spectitle = {{specmsg|tojson}};
        var maptitle = {{'8485-1901 Halpha'|tojson}};
        var map = {{map|tojson}};
        var mapmsg = {{mapmsg|tojson}};
        console.log('spaxel html', spaxel);
        m.galaxy.toggleInteract(map, spaxel, maptitle, spectitle);
        // $('#toggleinteract').on('click', m.galaxy, function() {
        //     m.galaxy.toggleInteract(spaxel, galimage, title);
        //});

    });
</script>
{% endblock code %}
